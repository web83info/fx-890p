# MTOOL Ver1.5

最近、FX-890Pのプログラムを載せはじめた、某D社の雑誌(一発で分かるな)にて、拙作「MTOOL Ver.1.00」が利用されているのを見つけました。
そのプログラムの入力方法の中で、やっぱりこのプログラムの弱点がさらけ出されてしまったので、その問題を解決した改訂版を発表します。

## 対応機種

すべてのFX-890P並びにその互換機で動きます。FX-890Pエミュレータなどがあれば、それでも動くんですがね...だれか、Windowsマシンなどで作ってみませんか。

## 入力方法

オールBASICです。黙ってカタカタ入力してください。

## WHAT'S NEW?

プログラムの先頭番地は任意の番地が設定できるようになりました。終了番地も任意に設定できます。

今回の「目玉」ですが、プログラムサイズが8の倍数でなくとも、勝手にダミーデータが書かれるようなことはなくなりました。つまり、例えば、プログラムが2000Hから2100Hまででも、2101Hから2107Hには、全く干渉しないということです。

前作では、その領域に勝手に書き込んでしまいました。それを回避するためには、一度少し多めにマシン語エリアを確保しておいて、終了してから、また、マシン語エリアを確保しなおすことが必要でした。プログラム中では、ダミーデータのエリアには```##```が置かれています。もちろん、チェックサムはきちんとつじつまがあうように計算してくれます。

## 使用方法

基本的には前作と同じです。まず、マシン語プログラムを完成させてください。これがないと話になりません。

マシン語プログラムが完成したら、そのプログラムの先頭番地と終了番地を確認しましょう。いったんアセンブルしなおして、番地を確認すると、プログラムは初期状態に戻るので、一石二鳥です。

そうしたら、最低Fエリアを一つは```NEW```しておいてください。まずプログラムを起動します。すると、書き込み式プログラムを出力させるファイルエリアを聞かれますので、先程```NEW```した、あるいは元々空いていたファイルエリアをテンキーで答えてあげてください。リターンキーを最後に押す必要はありません。

次に先頭番地と終了番地を聞かれますので、16進数4桁で答えてあげましょう。先頭に"&H"などはいりません。ちなみに、セグメントは```0000H```に固定です。必要ならば、プログラム中のセグメントの設定を書き換えてください。
開始番地より、終了番地が若いようならば、やり直しです。

すると、あとは勝手に書き込み式プログラムを作ってくれるのでプログラムが終わるのをじっと待っていてください。そんなに時間はかかりません。必要とされるメモリは、マシン語プログラムのサイズの2,3倍にもなりますので、覚悟しておいて下さい。もしエラーが出るようならば、空きメモリは十分にあるかを疑ってみてください。

マシン語プログラムを書き込む時は、BASICプログラムを素直に打ち込んで```RUN```させて下さい。誤りがあれば、```ERROR IN xxxxx```と表示が出ます。エラーがなければ```COMPELETED END!```と表示されます。

あと、書き込みプログラムの先頭の```FOR-NEXT```文の最初と最後が、実際の書き込みをされるアドレスの範囲です。

## チェックサムの仕組み

これも前作と同じです。BCSやFX-BCSで利用された方法と似ています。

次の例を見て下さい。

```
1) 2000 : 8B B8 EF FE 01 23 45 67
```

このようなデータがあるとします。この時、普通の方法で計算されたチェックサムは```00H```になります。しかし、```8```と```B```、```E```と```F```は見間違えやすいので、次のように打ち込んでしまいました。

```
2) 2000 : 8B 8B FE EF 01 23 45 67
```

これも、普通にチェックサムの計算をすると```00H```になってしまうのです。つまり、順番違いは全くチェックできないのです。困りますね。
ところが新開発された(少し嘘)FX-BCSやBCSで採用された方法を使うと、1)は```B2H```、2)は```49H```と区別されます。
このように計算しています。

```
8BH *1 + B8H *2 + EFH *3 + .... + 67H *8
```

しかし注意したいのは、一般的なチェックサムの計算方法と異なることです。普通のモニタではチェックサムが役に立ちません。結果も異なります。(当然)
もし一般的な方法でチェックサムを出力したかったら、プログラムに次のように変更を加えて下さい。

```
プログラム中に2回出てくる「*(J+1)」を取り除く。
```

ちなみに、このチェックサムを使えるようにする活研のミニモニタの差分は欲しいですか?

## 著作権のお話

「MTOOL Ver.1.5」(以下、このプログラム)はComputer fanへの投稿プログラムです。このプログラムは、パブリックドメインではありません。著作権は、作者が保有します｡

このプログラムは、自由にあなたのマシン語プログラムの投稿に利用することができますが、その時は必ず、出典先をドキュメントのどこかに記してください。また、このプログラムを投稿に使ったプログラムの著作権はあなたにありますが、その時は、そのプログラムに関する責任はすべてあなたにあります。

このプログラムは自由に転載することができるものとします。しかし、転載する際には、ファイル内容は、オリジナルのファイルを改竄しないでください。

作者は、このプログラムを使用した、あるいは使用できなかったことに関する一切の不都合に責任を追わないものとします。また、このプログラムにバグがあっても、バージョンアップは作者の義務ではありません。

このプログラムを改良して、どこかに発表したいと考える方がいるならば、オリジナルのファイルもすべて同時に配布するという条件付きで認めます。

## 参考文献

* 工学社：Z-1/FX-890P活用研究
* ABCP software:「MTOOL Ver.1.00」、PJ '96/5、工学社

## 変数表

### MTOOL自身

| 変数 | 用途 |
| --- | --- |
| I$,C$ | 汎用 |
| S | スタートアドレス |
| E | エンドアドレス |
| A | 行番号 |
| B$ | チェックサム生成用 |
| C | チェックサム計算用 |
| I,J | ループ |
| P | メモリのデータ |

### MTOOLによって作られたリスト

| 変数 | 用途 |
| --- | --- |
| L | 行番号 |
| I | アドレス |
| A$ | データリード用 |
| C | チェックサム検査 |
| J,I | ループ |
| J | アドレス補助 |
| P | 書き込むデータ |
