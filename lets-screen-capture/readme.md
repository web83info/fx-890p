# Let's Screen Capture

ソフトの紹介をするときに画面写真の有無で、説得力がかなり変わるものです。とはいっても、なかなか写真を同封するわけにもいかず、画面を見せることは難しいです。デジカメで撮って、アーカイブにまとめることもできますが、面倒です。そんなことを考えているうちに、「スクリーンキャプチャができれば便利だな」と思うようになって、このソフトができました。そんなこんなで、「ポケコンの画面を BMP 形式で保存する」プログラムです。

## 動作環境

直接ファイルエリアを操作している関係上、すべての機種で動くかどうかはわかりません。開発は、いつものように市販のFX-890Pで行いました。Z-1GRでの動作確認は、一応してあります。

## 入力方法

まず、マシン語エリアを確保します。確保する容量は、同時に作動させるプログラムにもよりますが、このプログラムが使用するのは2E6Hバイトだけです。ちなみに、このプログラムはリロケータブルなので、マシン語エリア内におけばどこでも大丈夫です。

マシン語プログラムを同時に使わないのであれば、

```
CLEAR 1024,&H2E6,6144
```

としてください。ただし、BASICプログラムなどでこれ以上の値を要求される場合は、この限りではありません。

## 使用方法

以下、このプログラムが2000Hにあるものとして話を進めます。

まず、最低一つのファイルエリアを空にしてください。そこにデータをセーブします。そうしたら、

```
CALL&H2000,［0から9までのファイルエリアのナンバー］
```

と入力して初期化します。例えば、F0 を指定したければ、

```
CALL&H2000,0
```

とします。この時点で、ファイルエリアが空でなかったり、メモリが十分にないときはエラーが出ます。成功すると、その旨を示すメッセージが表示されて830バイトのファイルエリアを確保し、ヘッダーを書き込みます。

プログラムを常駐、または常駐解除させるには次のようにします。

```
CALL&H2000
```

常駐するとキー割り込みがフックされて、何かキーを押すごとにそのルーチンが呼び出されます。といっても、普通にキーを押したときは何もしないで、ROM のルーチンに処理を返します。電源を切ると、常駐は解除されます。

ほかのプログラムからこのプログラムを呼び出すには、[SHIFT]が押された状態で[CALC]を押します。この順番を逆にするとうまくいきません。（これは割り込みの関係上、仕方がないことなのです。）

そうすると動きが止まるので、どのファイルエリアにセーブするか、テンキーで入力してください。このとき、ヘッダーが書き変わっているか、サイズはきちんと確保されているかなどのチェックをします。

「うまくいっても、だめになっても」、、、それが私の生きる道、じゃなくて結果は画面に表示されません。セーブは一瞬で終わるので、本当にセーブされているのかどうか解りにくいですが、他のプログラムとの相性もありますのでこうなっています。

後は、ファイルエリアにBMPファイルができるので、外部記憶装置にセーブしてください。

保存ですが、FX-890Pは標準では、バイナリファイルの読み書きができません。（BSAVEで処理するとマシン語ファイルのヘッダーがついてしまう。）テキストデータとして強引にF.COMを使ってFDにセーブすると、ファイルサイズが831になってしまいますが（最後に1AHがつく）、パソコンでのBMPファイルの表示はきちんとできます。サイズが気になる人は、パソコンのバイナリエディタなどで書き換えてください。または、一度「ペイントブラシ」などで読み込んでから、再びセーブするとうまくいきます。パソコンに転送できたら、画像関連のツールが山のようにありますから、拡大するなり印刷するなりできます。

RS-232Cのインターフェースをもっていないので、RS-232C経由の保存についてはどうなるかわかりません。不都合が生じた方で、ソースがわかる方は、適当にソースを書き換えて使ってください。Z1BIN なるプログラムが出回っているようですが、私はよく知らないのでごめんなさい。

## マシン語プログラムについて

マシン語プログラム中でキー割り込みを勝手に乗っ取ったり、割り込みを禁止しているプログラムでは、このソフトは動作しません。また、他のマシン語プログラムのLCDCアクセス状態によっては、セーブして復帰するときにうまくいかないことがあるかもしれません。もっとも、そのような状況に接したことはありません。

## 技術的なこと

このプログラムでは、VRAM は全く関係なくキャプチャーします。だから、サンプルの「GALAXY WALL」「GALAXY WALL TWIN」のように VRAM を独自の方法で使っていても、「Overnight Sensation Remix」のように VRAM を使っていなくても問題ありません。

## 参考文献
工学社：Z－1／FX-890P活用研究
