# POKER ACTION for FX-890P

今回は、G815の名作「POKER ACTION」を移植してみました。

トランプゲームとしては、おそらく7並べの次に有名だと、勝手に私が思っているポーカーと、テトリス、ぷよぷよをはじめ万人に受けるゲームのジャンル、落ち物を組み合わせると最強のゲームになるはずです。私も、今まで遊んできて、何でこんなゲームが今までなかったのかなと思ったほどでした。この面白さをG815ユーザーのみのものにするのはもったいないと思うので、どうぞ、遊んでみてください。

それから、原作と差別するために、若干のオリジナル要素を付け加えてありますので、G815でオリジナルを遊んだことのある方もぜひ遊んでみてください。

## 動作環境

FX-890Pとその互換機で動きます。Z-1GRでも動作します。

## インストール

マシン語で組まれています。BASICかCALモードで

```
CLEAR 1024,&HD2A,6144
```

と打ち込んで、マシン語エリアを確保してください。```poker-action.bas```を読み込んで実行してください。

バイナリセーブするには、以下のコマンドを実行してください。

```
BSAVE "POKER.BIN",&H2000,&HC81
```

## 遊び方

画面の左から右にトランプが流れてきます。縦、横にトランプを5枚並べて「役」を作ってください。5枚並んだトランプは消えます。役に応じて得点が加算されます。ブタかワンペアの低い役を作ると、画面右からおじゃまブロックがせり上がってきます。これはストレート以上の役を作ると消すことができます。

ただし、フラッシュは永久パターンの元になるので、得点は加算されません。画面上には同じトランプはあらわれません。

トランプは、[8]、[2]で上下移動、[6]で高速右移動です。ゲーム中は[P]でポーズがかかり、[RET]で解除できます。[BRK]を押すとプログラムを終了できます。リプレイは[RET]です。

## オリジナル要素

移植にあたって、JOKER（ゲームでの表示は（J））が追加されました。もちろん、JOKERは一番高い役になるように判定されます。さらに、ポーカーのルールには無い「ロイヤルストレート（トランプのマークに関係なく10,J,Q,K,Aが揃う）」という役を付け加えました。

## アルゴリズム

一見面倒そうな、ポーカーの役の判定ですが、こんな方法でやってみました。

### JOKERがないとき

#### (1) フラッシュかどうかを調べます。

これは、5枚のトランプのマークが一致するかを調べればいいのですから簡単ですね。このフラグを表す変数をAとしましょう。

#### (2) ストレートがあるか調べます。

これが一番面倒です。まず、1枚目のトランプを先頭にしてストレートが成り立つかを調べます。ストレートが成り立つかどうかは、プラス1した数字が残りのトランプにあるかを4回調べればよいのです。

ここで、Kの次はAにするのをお忘れなく。このフラグを表す変数をBとします。ここで、ストレートがAで終わっていたときには、さらにロイヤル系の役が付きます。このフラグを表す変数をCとしましょう。

#### (3) ペアがあるか調べます。

A～Kのそれぞれについて、5枚のカードの中に何枚あるかを調べます。それぞれ2枚、3枚、4枚、5枚同じカードがあったときに、その様子を記録する変数をそれぞれD，E，F，Gとします。それらの変数はペアが「いくつ」あったかを記録するようにします。

#### (4) 役の判定をします。

例えば、A=B=C=1ならロイヤルストレートフラッシュ、A=B=C=0かつD=E=1ならフルハウスです。A=B=C=0かつD=2ならツーペアです。

こんな感じで、場合分けしましょう。高いほうの役から判定していって、その役にあてはまらなかったら次の役、といった形で判定して、それを数字化しておきます。この変数は、ただの数字の条件比較ですから簡単です。

### JOKERがあるとき

JOKERが、52枚のカードのうちどのカードだったら一番高い役が付くかを調べます。その方法とは、そうです、52回(1)～(4)を繰り返すのです。でも、マシン語なら一瞬で終わります。

オリジナル版のディスアセンブルをした訳ではないので、もしかしたらもっと効率のいい方法で判定しているのかもしれませんが、私にはこんな方法しか思い付きませんでした。
