# MIRRORIS-V

## こんなゲームです

左から流れてくるブロックやミラ－を、フラッシュボ－ルを使い反射させながらブロックを消していくゲームです。

さらに、同じゲームをBASICと機械語の両方で組みましたので、「BASICマスター」の方も是非やってみてください。

## 機種や言語

このプログラムは、カシオより発売されている16ビットポケコン「FX-890P」、および、同社から学校教育用に発売されている、つまり市販されていませんが、工業高校生に人気の高い「Z-1」で動作確認しております。言語は、BASICバージョンと機械語バージョンがあります。それぞれをリスト1、リスト2とします。

## 入力方法＆実行方法

今日ポケコンを手にした人でも分かるように書きますので、よく読んでください。

1. 電源を入れます。

2. [MENU]→[2]→[SHIFT]+[（数字キー）]と押して、空いているプログラムエリアを選択します。

3. 「LOAD”ファイル名”」として、付録CD-ROMからファイルを読み込みます。但し、MD-120を使用する方は、階層ディレクトリに対応していないのを忘れないでください。また、RS-232C経由で、転送に失敗してしまう方は、通信条件をもう一度確認してください。

以下、リスト2を使う人だけにあてはまります。

4. ```CLEAR 1024、3655、6144```と入力して機械語エリアを確保して、```RUN```と入力して、機械語プログラムをメモリ上に書き込みます。

5. もしチェックサムエラーが発生したら、文字化けしている証拠です。FD経由ではこのエラーは起こることはまずありません。RC-232C経由の方は、もう一度転送条件を確認してください。"COMPLETED END!"と表示されたら終了です。

なお、実行する前には、大切なプログラムは必ず外部記憶装置に保存してください。このプログラム自体は、MD-120なら、

```
DEFSEG=0
BSAVE”0:MIRRORV.BIN, &H2000, &HDF0
```

とすれば保存できます。RS-232C上に出力する場合は、ファイルディスクリプタを変更すればOKです。

## ルール

左から4種類のブロックやミラ－とフラッシュボ－ルが、右へ流れていきます。ブロックやミラーをいくら積み重ねてもそれだけでは消えません。一定サイクルで落ちてくるフラッシュボールを使って、初めて消すことができるのです。

基本的にフラッシュボ－ルが通った後は、ブロックやミラ－が消えます。ただし、模様付きのブロックは模様がなくなるだけです。某ぷよぷよの固ぷよと考えてください。消えた結果、宙に浮いてしまったブロックは「基本的に」右に落ちます。

また、（これがこのゲームの”売り”なのですが）ミラ－にぶつかるとフラッシュボールが反射します。向きは、現実世界と同じよう90度変化します。その様にして多くのブロックを消し続けて下さい。

### 反応例

```
｜　　反応前　　　｜　　反応後　　　｜
｜　　　　　　　　｜　　　　　　　　｜
｜　　／□＼■□□｜　　　　　　■□｜
｜　　□□□□＼□｜　　　　　□□＼｜
｜Ｏ→／□□□■■｜　　　　□□■□｜
｜　　　　＼□□／｜　　　　　　　　｜
｜　　　　　　　　｜　　　　　　　　｜
```

### 公式（化学反応式風に）

```
○ ＋ □ → スコア
○ ＋ ■ → スコア ＋ □
○ ＋ ／ → スコア ＋ ↑
○ ＋ ＼ → スコア ＋ ↓
```

## 操作方法

ゲーム中は、[2]、[6]、[8]が有効です。それらは、落ちてくるブロックをそれぞれの方向に動かします。それぞれの方向って言うのは、[2]＝下、[6]＝高速落下、[8]＝上ということです。

残念ながらゲームオーバーになってしまった場合には、[RET]でタイトルに戻ります。

## 互換性について

BASICバージョンと機械語バージョンでは、微妙なところが異なりますので、ご注意ください。

### (1) BASICバージョン

* ゲームオーバー時に、スコアトライアルのパスワードがでます。単純な暗号化をしただけですが…

* スコアの計算の仕方が(2)と異なります。こちらの方が、スコアは高くなるようになっています．．

* ```CHR$(252)```〜```CHR$(255)```のフォントを書き換えます。

* フラッシュボールの通ったすぐ後にブロックが落ちます。このため、画面右から左にフラッシュボールが移動する時には、このことを考えて下さい。すり抜けているわけではありません。

* [6]を押したら着地するまで止まりません。

* スピードが遅いです。(^^;

### (2) )機械語バージョン

* [P]]キーでポーズが出来ます。解除は[RET]です。この時の、「擬似」WINDOW表示がかっこいいでしょう。

* タイトル画面では、[RET]、[O]キーが有効です。[RET]を押すとゲームが始まり、[O]を押すと、オプションモードに入ります。この時の、擬似WINDOW表示もかっこいいでしょう。

* OPTION MODEで「GAME MODE」が選べますが、これはブロックの落ち方が違うということです。「A」は連鎖が終わるまでブロックが落ちない（＝フラッシュボールが一度画面外に出ると、落ちる）、「B」はBASIC版と同じ落ち方、「C」は一切ブロックが落ちません。無重力とでも思ってください。

* さらに、「BALL」はフラッシュボールの落ちてくる割合を設定します。有効な設定値は2から60で、nに設定すると、n回に一度だけフラッシュボールが落ちてきます。

* [6]は押している間だけ働きます。

* フラッシュボールがアニメーション（もどき）します。しかも、フォントは自作のものを使用しています。

* GAME OVER時に画面が反転しますが、スコアトライアルは出来ません。

* プログラムの中断は、絶えず（というとちょっとだけ嘘になりますが…）することができます。この時、電源スイッチのチェックもやっています。これで授業中も安心です。

* [BRK]を押したときは、BIOS、AH=7FHを利用して、電源をオフにします。この時の状態はAPO（オートパワーオフ）なので、[BRK]を押すと同時に電源が入るというわけです。ですから、この時、一瞬画面の表示がオフにされますが「バグじゃあーリません、仕様ですーっと」。割り込みベクタを書き換えたりするプログラムでは、この方法をとると、かなり便利です。ちなみにこのプログラムでは、そんなことしていません。

## プログラム

BASICには変数表と行マップをつけたので、そんなに説明いらないと思います。
BASICは、式を不要なまでに展開し、論理式を多用しています。```FOR-NEXT```ループを使って```GOTO```文を減らしています。

画面データの記憶ですが、2次元配列を使わずに横一列のデータを一つの文字変数に入れています（表示処理の高速化のため）。

苦労した点といえば、そうだなぁ…別にないかな、簡単だったから。敢えて言えば、タイトル画面の作成にグラフィックエディタがなかったから、手書きでやったことくらいです。

書きたいことは、山ほどあるのですが厳選して書きます。みんな、FX-890Pでプログラムしよう。CPUは8086系だから、覚えた知識がそのまま98やDOS/Vに生かせます。「インテル、入ってる」に留まらず、「インテル、使ってる」くらいになりましょう。

FX-890Pで高速なプログラムを作りたい方へ。LCDCを直接いじって、表示部分だけでも機械語で書いてみましょう。きっときっときっときっとその速さに驚きますよ。LCDCのアクセスの仕方は、参考文献1のP14、15、119~125を参照してください。

## 次回作

今度から、付録CD-ROMにプログラムが収録されるので、大作も気兼ねなく投稿できそうです。あ、手抜きしてプログラムの圧縮をしないわけではないですよ。その大作とは、「Galaxy Wall Twin Ⅱ for FX(仮)」です。また昔、同ゲームの前バージョンを投稿したのですが、見事に没ってしまったようです。その汚名返上、名誉挽回のために、かなり気合を入れて作っています（特にグラフィック関係）。全部機械語です。もしかしたら、2本をゲームをカップリングさせるかもしれませんので、その時はよろしくお願いします(しまった、内輪ネタだ!)。

## 参考文献

1.Z-1/FX-890P活用研究、工学社

2.[PC-E550 PC-1490Ⅱ] 活用研究、工学社

3.「MTOOL VER1.00」、ABCP software、ポケコンジャーナル誌、’96/5 P4、5、工学社

4.「Basic Command Converter」、ABCP software、ポケコンジャーナル誌、’96/5 P6~9、工学社

5.「PJ100号記念シューティング」、たかじょゆうき。5浪記念作品、ポケコンジャーナル誌、’96/5 P56~61、工学社

## 表1：行マップ

```
100～130  REM
140～160  タイトル描画
170～200  初期設定
210～250  画面描画
260～     メインルーチン
270      NEXT表示
290～320  キー入力受け付け
340      ブロック記憶
350      ゲームオーバー判定
360      パスワード計算
370～390  ゲームオーバー
400～     フラッシュボール判定
450～460  反射
470～490  表示
500      画面外判定
520～750  グラフィックデータ
```

## 表2：BASICバージョンの変数表

```
（変数）  （内容）
J、I   ループ
D$    落ちるブロック
M$(3)) 画面のブロック記憶
N     ネクストのブロックの種類
G     ループ（ゲームオーバー判定）
X     X座標
Y     Y座標
B     現在のブロックの種類
T     表示用速度
F     ループ（落ちられる間）
I     VAL（INKEY$）
Z     Y座標加算値
F     パスワード計算用ワーク
S     スコア
B$    パスワード
U     反射時のX加算値
V     反射時のY加算値
R     得点の上がる率（反射した回数＋1）
C     今回の連鎖で加算される得点
Q     処理中のブロックのコード
K     消したブロック数
P     ブロック出現割合
```

## 表3：メモリマップ

```
02000H～02DEFH プログラム本体
02DF0H～02E46H ワークエリア
```
