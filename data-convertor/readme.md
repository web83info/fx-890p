# Data Convertor Ver.1.0

このプログラムは、PC-E500シリーズ（以下「E500」）のゲーム・プログラムをZ-1に移植する際の手助けをするものです。自作プログラムの移植に重宝しています。
このプログラムは、FX-890P/Z-1/Z-1GRで動作します。ただし、Z-1GRでは一部プログラムの変更が変更です（後述）。
以下、文中での「Z-1」という表記は、FX-890P/Z-1GRも含めた意味です。

## 概要

キャラクタ・データを変換するときに、指を折りながら変換していませんか？そんな苦労はもう不要！
このプログラムは```DEFCHR$```と```GPRINT```の相互データ・コンバートはもちろん、ROM内のフォントまで拡大してくれます。

## 入力方法

オールBASICなので、気楽に入力してください。ただし、メモリに直接データを書き込むところがあるので、```POKE```命令と```DEFSEG```命令には注意してください。
Z-1GRを使っている人は、420行にある```&H9F4```を```&H9F6```に変更してください。

## 使い方

```RUN```すると、メニュー画面が出ます。[2][8]キーで選び、[リターン]キーでそれぞれのモードに入ります。
[SPACE]キーを押せば、どのモードからでもメニューに戻ります。なお、必ず[CAPS]キーをロックしておいてください。

### (1) GPRINT→DEFCHR$

```GPRINT```のデータを```DEFSEG$```のデータに変換します。カーソルが出たら、変換したいデータを入力してください（64文字以内）。すると、変換されたデータとともに、キャラクタを表示します。このとき、[IN]キーを押せばデータを```CALC$```に取り込むことができます。

### (2) DEFCHR$→GPRINT

上記の逆です。ただし、[IN]を押しても```CALC$```にデータを取り込めませんし、キャラクタも表示しません。

### (3) MAGNIFY CHARACTER

ROM内のフォントを拡大します。海外フォントも読み出せます。画面上方に現在のモードが示されています。「JPN」は日本、「ENG」は海外です。モードは[M]キーを押せば切り替えられます。拡大したいキャラクターコードを入力すれば、拡大表示されます。

## プログラムの特徴

細かいところに気を使っています。

1. ```POKE&H1775,5```とすればカーソルの表示が消えます。これによって、```INKEY$```のループを組まずに```INPUT$```で処理できます、

2. サブルーチン```*IN```では[0]〜[9]、[A]〜[F]以外の文字は入力できません。ただし、間違えたときのために[BS]キーや[←]キーで1文字前に戻れます。

3. キャラクタを拡大するときにマス目を表示しますが、これはキャラクタ・コード252番をワーク・エリアとして使い、素早く表示しています。グラフィックを使うと重いので…

4. 2進法にする処理がありますが、AND命令を使うと、速く処理されます。

## データ・コンバートの方法

基本は簡単です。まず、変換したいデータを用意します。そのデータが奇数長なら、文字列の最後に```0```を加えます。次に、データの順番を入れ替えるのですが、方法が面倒です。

1番目と2番目、3番目と4番目のように、2つずつ組にしてデータの前後を入れ換えます。なぜなら、E500の```GPRINT```データとZ-1の```DEFCHR$```のデータの並び方が、ちょうど逆だからです。

```
変換前：0123456789ABCDEF
変換後：1032548798BADCFE
```

しかし、これをまともにZ-1にやらせると遅いので、ループと計算をうまく利用して、擬似的に入れ換えています。

次に、このデータをあらかじめ用意したデータと取り替えます。データの並び方が同じなら、あとは上から数えるか下から数えるかの違いなので、こんなことができるのです。

```
変換前：0123456789ABCDEF
変換後：084C2A6E195D3B7F
```

プログラムしていて気がついたのですが、相互のコンバートは同じ方法でできます。実際にデータ変換をしている部分は1,2行しかないので、解析してみてください。ちなみに、64文字のデータ変換に要する時間は1.5〜2秒です。

## 改造点

1. 文字入力時に小文字も受け付けられるようにする。

2. サブルーチン```*IN```にパラメータを与え、汎用の文字入力ルーチンにする。

3. データをテキスト・エリアに保存できるようにする

4. ハイパー関数プログラム・カードに対応させる（上下の関係が逆になります）

## 参考文献

1. Z-1/FX-890P活用研究、工学社

2. FX-890P言語入門書「C言語・BASIC・CASL編」、カシオ計算機